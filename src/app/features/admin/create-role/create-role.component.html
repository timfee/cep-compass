<mat-card class="create-role-card">
  <mat-card-header>
    <mat-icon mat-card-avatar>admin_panel_settings</mat-icon>
    <mat-card-title>Create CEP Admin Role</mat-card-title>
    <mat-card-subtitle>Set up delegated admin for Chrome management</mat-card-subtitle>
  </mat-card-header>
  
  <mat-card-content>
    @switch (state()) {
      @case ('checking') {
        <div class="center-content">
          <mat-spinner diameter="40"></mat-spinner>
          <p class="status-text">Checking for existing CEP Admin role...</p>
        </div>
      }
      
      @case ('exists') {
        <div class="existing-role-content">
          <mat-icon color="accent" class="large-icon">check_circle</mat-icon>
          <h3>CEP Admin Role Already Exists</h3>
          <p class="role-info">Role ID: <strong>{{ existingRole()?.roleId }}</strong></p>
          <p class="description">{{ existingRole()?.roleDescription }}</p>
          
          <div class="action-buttons">
            <button 
              mat-raised-button 
              color="primary" 
              (click)="openAdminConsole()"
              class="primary-action">
              Manage Role Assignments
              <mat-icon>open_in_new</mat-icon>
            </button>
            
            <button 
              mat-button 
              (click)="copyRoleId()"
              class="secondary-action">
              <mat-icon>content_copy</mat-icon>
              Copy Role ID
            </button>
          </div>
        </div>
      }
      
      @case ('ready') {
        <div class="ready-content">
          <p class="description">
            Ready to create the CEP Admin delegated role with Chrome Enterprise permissions.
          </p>
          
          <div class="privileges-section">
            <h4>Included Permissions:</h4>
            <mat-list class="privileges-list">
              @for (privilege of privileges; track privilege.privilegeName) {
                <mat-list-item>
                  <mat-icon matListItemIcon>check</mat-icon>
                  <span matListItemTitle>{{ formatPrivilege(privilege) }}</span>
                </mat-list-item>
              }
            </mat-list>
          </div>
          
          <div class="action-buttons">
            <button 
              mat-raised-button 
              color="primary" 
              (click)="createRole()"
              class="create-button">
              Create CEP Admin Role
              <mat-icon>add</mat-icon>
            </button>
          </div>
        </div>
      }
      
      @case ('creating') {
        <div class="center-content">
          <mat-progress-bar mode="indeterminate"></mat-progress-bar>
          <p class="status-text">Creating CEP Admin role...</p>
          <p class="status-detail">This may take a few moments...</p>
        </div>
      }
      
      @case ('success') {
        <div class="success-content">
          <mat-icon color="primary" class="large-icon success-icon">check_circle</mat-icon>
          <h3>CEP Admin Role Created Successfully!</h3>
          <p class="role-info">Role ID: <strong>{{ createdRole()?.roleId }}</strong></p>
          
          <div class="action-buttons">
            <button 
              mat-raised-button 
              color="primary" 
              (click)="openAdminConsole()"
              class="primary-action">
              Assign Users to Role
              <mat-icon>open_in_new</mat-icon>
            </button>
            
            <button 
              mat-button 
              (click)="copyRoleId()"
              class="secondary-action">
              <mat-icon>content_copy</mat-icon>
              Copy Role ID
            </button>
          </div>
          
          <mat-expansion-panel class="next-steps">
            <mat-expansion-panel-header>
              <mat-panel-title>Next Steps</mat-panel-title>
              <mat-panel-description>
                How to assign users to the CEP Admin role
              </mat-panel-description>
            </mat-expansion-panel-header>
            
            <ol class="steps-list">
              <li>Click "Assign Users to Role" above</li>
              <li>Add users who should have Chrome management permissions</li>
              <li>Users will receive an email notification about their new role</li>
              <li>They can then use CEP Compass with their delegated permissions</li>
            </ol>
          </mat-expansion-panel>
        </div>
      }
      
      @case ('error') {
        <div class="error-content">
          <mat-icon color="warn" class="large-icon">error</mat-icon>
          <h3>Error Creating Role</h3>
          <p class="error-message">{{ error() }}</p>
          
          <div class="action-buttons">
            <button 
              mat-raised-button 
              color="primary" 
              (click)="retry()"
              class="retry-button">
              <mat-icon>refresh</mat-icon>
              Try Again
            </button>
          </div>
        </div>
      }
    }
  </mat-card-content>
</mat-card>